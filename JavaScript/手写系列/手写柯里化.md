- [手写柯里化](#手写柯里化)
  - [简易版（不支持占位符，ES5 代码）](#简易版不支持占位符es5-代码)
  - [简易版（不支持占位符，ES6 代码）](#简易版不支持占位符es6-代码)
  - [进阶版（支持占位符，ES5 代码）](#进阶版支持占位符es5-代码)
  - [进阶版（支持占位符，ES6 代码）](#进阶版支持占位符es6-代码)

# 手写柯里化

## 简易版（不支持占位符，ES5 代码）

```js
function curry(fn) {
  var len = fn.length;

  return function nest() {
    var args = [].slice.call(arguments);

    if (args.length >= len) {
      return fn.apply(this, args);
    }

    return function () {
      return nest.apply(this, args.concat([].slice.call(arguments)));
    };
  };
}

// 测试：

var fn = curry(function (a, b, c) {
  console.log([a, b, c]);
});

// 以下都输出：['a', 'b', 'c']
fn('a', 'b', 'c');
fn('a', 'b')('c');
fn('a')('b')('c');
fn('a')('b', 'c');
```

## 简易版（不支持占位符，ES6 代码）

```js
function curry(fn) {
  const len = fn.length;

  return function nest(...args) {
    if (args.length >= len) {
      return fn.apply(this, args);
    }

    return function (...args2) {
      return nest.apply(this, [...args, ...args2]);
    };
  };
}

// 测试：

const fn = curry(function (a, b, c) {
  console.log([a, b, c]);
});

// 以下都输出：['a', 'b', 'c']
fn('a', 'b', 'c');
fn('a', 'b')('c');
fn('a')('b')('c');
fn('a')('b', 'c');
```

## 进阶版（支持占位符，ES5 代码）

略

## 进阶版（支持占位符，ES6 代码）

```js
function curry(fn, placeholder) {
  let args = [];
  let holders = [];

  return function nest() {
    // 本轮新纪录的占位符
    const newHolders = [];

    for (let i = 0; i < arguments.length; i++) {
      const arg = arguments[i];

      // 当前是占位符，之前不存在占位符，则记录新的占位符的位置
      if (arg === placeholder && !holders.length) {
        args.push(arg);
        newHolders.push(args.length - 1);
      }
      // 当前是占位符，之前存在占位符，则删除之前的，同时记录新的占位符位置
      else if (arg === placeholder && holders.length) {
        const lastIndex = holders.shift();
        newHolders.push(lastIndex);
      }
      // 当前不是占位符，之前不存在占位符，则直接记录数据
      else if (arg !== placeholder && !holders.length) {
        args.push(arg);
      }
      // 当前不是占位符，之前存在占位符，则占位符替换为数据
      else if (arg !== placeholder && holders.length) {
        const lastHolderIndex = holders.shift();
        args[lastHolderIndex] = arg;
      }
    }

    // 更新目前有多少占位符
    holders = holders.concat(newHolders);

    // 参数收集够了，并且没有占位符了，真正的调用函数
    if (args.length >= fn.length && !holders.length) {
      const result = fn.apply(this, args);

      args = [];
      holders = [];

      return result;
    }

    // 继续收集参数
    return nest;
  };
}

// 测试：
const _ = {};
const log = function (a, b, c, d, e) {
  console.log([a, b, c, d, e]);
};
const fn = curry(log, _);

// 以下都输出：[ 1, 2, 3, 4, 5 ]
fn(1, 2, 3, 4, 5);
fn(_, 2, 3, 4, 5)(1);
fn(1, _, 3, 4, 5)(2);
fn(1, _, 3)(_, 4)(2)(5);
fn(1, _, _, 4)(_, 3)(2)(5);
fn(_, 2)(_, _, 4)(1)(3)(5);
```
