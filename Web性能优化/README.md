# Web 性能优化

- 网络层面
- 构建层面
- 浏览器渲染层面
- 服务端层面

> **深入理解 http 请求是前端性能优化的核心**

## 可优化的地方

- **资源的合并与压缩**

  > 减少 http 请求数量 和 减少请求资源大小

  - html 压缩

    - nodejs 提供的 `html-minifier` 压缩
    - 后端模板引擎渲染压缩

  - css 压缩

    压缩点：

    - 删除无效代码
    - 删除注释
    - css 语义合并

    压缩方法：

    - 使用 `html-minifier` 对 html 中的 css 进行压缩
    - 使用 `clean-css` 对 css 进行压缩

  - JavaScript 压缩与混乱

    压缩点：

    - 删除无效字符
    - 删除注释
    - 代码语义的缩减和优化
    - 代码保护（混乱代码，降低可读性，增加安全）

    压缩方法：

    - 使用 `html-minifier` 对 html 中的 js 进行压缩
    - 使用 `uglifyjs2` 对 js 进行压缩

  **不进行文件合并带来的一些问题：**

    ![](./imgs/file_compress.png)

    - 文件与文件之间有插入的上行请求，增加了 `n - 1` 个网络延迟
    - 丢包问题可能更严重
    - 经过代理服务器时可能被断开

  **文件合并存在的问题：**

    - 首屏渲染时间延长
    - 缓存失效（合并的文件有一个存在改动，都会使合并的大文件缓存失效）

  **文件合并可取的办法：**

    - 公共库合并
    - 不同页面分别合并（按需加载）

- 图片编解码原理和类型选择
- 浏览器渲染机制
- 懒加载 / 预加载
- 浏览器储存
- 缓存机制
- PWA
- Vue-SSR

++++++++++++++++++++++++++++++++++++++++++++

- 通过在线网站 和 fis3 两种实现压缩与合并

浏览器的一个请求从发送到返回都经历了什么？

![](./imgs/what_happen_when_url_send.png)

潜在的性能优化点：

- 是否可以通过缓存减少 dns 查询时间？
- 是否网络请求的过程走最近的网络环境？
- 相同的静态资源是否可以缓存？
- 能否减少 http 请求的大小？
- 减少 http 请求次数
- 服务端渲染
